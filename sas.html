/* Create a fileref that executes a shell command when read from */
filename out pipe "ls -d /ruta/a/datos/*/";

/* Create a dataset named 'carpetas' with the directory names */
data carpetas;
   infile out truncover;
   input nombre $char100.;
   if substr(nombre, length(nombre)) = '/' then nombre = substr(nombre, 1, length(nombre)-1);
run;

/* Clear the 'out' fileref */
filename out clear;

/* Create a dataset to store the file names */
data files;
   length nombre $100 file_name $100;
   retain nombre;
   set carpetas end=eof;
   call execute('filename indata pipe "ls '||trim(nombre)||'";');
   call execute('data _temp; infile indata; input file_name $char100.; nombre="'||trim(nombre)||'"; output; run;');
   if eof then call execute('proc append base=files data=_temp; run; proc datasets library=work; delete _temp; quit;');
run;
